<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Getting Started · CARMI</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Overview"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Getting Started · CARMI"/><meta property="og:type" content="website"/><meta property="og:url" content="https://carmi.js.org/index.html"/><meta property="og:description" content="## Overview"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="CARMI"/><h2 class="headerTitleWithLogo">CARMI</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavItemActive"><a href="/docs/getting-started.html" target="_self">Getting started</a></li><li class=""><a href="/docs/api.html" target="_self">API</a></li><li class=""><a href="/docs/design.html" target="_self">Design</a></li><li class=""><a href="/docs/help.html" target="_self">Help</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Getting Started</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>CARMI is a build time tool that transforms a Directed Acyclic Graph of derivations and setters into the source code of
an optimized function that calculates your derivations/computed-state and maintains them as long as you change your
model only using the setters you defined.</p>
<blockquote>
<p>Phil Karlton - &quot;There are only two hard things in Computer Science: cache invalidation and naming things&quot;</p>
<p>I can't help you much with naming stuff (although you tend to name significantly fewer things in CARMI as you just let
the data flow from one derivation to the next) - but I sure you hope we never have to think of cache invalidation
again</p>
</blockquote>
<p>Install Carmi using <a href="https://yarnpkg.com/en/package/carmi"><code>yarn</code></a>:</p>
<pre><code class="hljs css languages- bash">yarn add --dev carmi
</code></pre>
<p>Or <a href="https://www.npmjs.com/"><code>npm</code></a>:</p>
<pre><code class="hljs css languages- bash">npm install --save-dev carmi
</code></pre>
<p>Create your first model</p>
<pre><code class="hljs css languages- js"><span class="hljs-comment">/// model.carmi.js</span>
<span class="hljs-keyword">const</span> { root, arg0 } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'carmi'</span>);
<span class="hljs-keyword">const</span> model = {
  <span class="hljs-attr">doubled</span>: root.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.mult(<span class="hljs-number">2</span>)),
  <span class="hljs-attr">setItem</span>: setter(arg0)
};
<span class="hljs-built_in">module</span>.exports = model;
</code></pre>
<p>Configure webpack</p>
<p>Within your webpack configuration object, you'll need to add the Carmi loader to the list of modules:</p>
<pre><code class="hljs css languages- javascript"><span class="hljs-built_in">module</span>: {
  <span class="hljs-attr">rules</span>: [
    {
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.carmi.js$/</span>,
      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/(node_modules|bower_components)/</span>,
      <span class="hljs-attr">use</span>: {
        <span class="hljs-attr">loader</span>: <span class="hljs-string">'carmi/loader'</span>
      }
    }
  ];
}
</code></pre>
<pre><code class="hljs css languages- js"><span class="hljs-comment">/// you can load your generated code either using a babel loader / a webpack plugin or just add a build step to generate the source</span>
<span class="hljs-keyword">const</span> modelFunction = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./model.carmi'</span>);
<span class="hljs-keyword">const</span> instance = modelFunction([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);
<span class="hljs-comment">// each property defined on the model object generates either a derived value or a setter</span>
<span class="hljs-built_in">console</span>.log(instance.doubled);
<span class="hljs-comment">// prints [2,4,6,8]</span>
instance.setItem(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);
<span class="hljs-built_in">console</span>.log(instance.doubled);
<span class="hljs-comment">// prints [20,4,6,8]</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="derived-state"></a><a href="#derived-state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Derived state</h2>
<p>You derive your computed state using the Lodash inspired DSL - checkout the API section for a complete listing</p>
<p>A few key concepts</p>
<ul>
<li><strong>root</strong> and everything derived from it is chainable</li>
<li>Everything is declarative, there is no data compile time - much like Lodash-FP or Ramda</li>
<li>Anything you derive but don't export from your model never happens</li>
<li>Nothing changes in place - you are defining a series of transformations, for example <strong>assign</strong> won't modify the input
array it gets, it just generates a new object with the result</li>
<li><strong>call</strong> is your escape hatch - you can use it to do any transformation that is not part of the DSL, but treat the
inputs as read only otherwise bugs will happen</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="reactions"></a><a href="#reactions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reactions</h3>
<p>While the derived state is always synchronized with the state, sometimes you want reactions triggered to connect the
derived state to the external world, the current method to implement these is using the <strong>call</strong> api to trigger the
reaction on your values.</p>
<pre><code class="hljs css languages- js"><span class="hljs-comment">/// model-reactions.carmi.js</span>
<span class="hljs-keyword">const</span> { root, arg0 } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'carmi'</span>);
<span class="hljs-keyword">const</span> model = {
  <span class="hljs-attr">doubled</span>: root.map(<span class="hljs-function">(<span class="hljs-params">item, idx</span>) =&gt;</span> item.mult(<span class="hljs-number">2</span>).call(<span class="hljs-string">'logItemChanged'</span>, idx)).call(<span class="hljs-string">'logArrayChanged'</span>),
  <span class="hljs-attr">setItem</span>: setter(arg0)
};
<span class="hljs-built_in">module</span>.exports = model;
</code></pre>
<pre><code class="hljs css languages- js"><span class="hljs-keyword">const</span> modelFunction = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./model-reactions.carmi'</span>);
<span class="hljs-keyword">const</span> instance = modelFunction([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>], {
  <span class="hljs-attr">logItemChanged</span>: <span class="hljs-function">(<span class="hljs-params">value, idx</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'itemChanged'</span>, idx, value);
    <span class="hljs-keyword">return</span> value;
  },
  <span class="hljs-attr">logArrayChanged</span>: <span class="hljs-function"><span class="hljs-params">arr</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'arrayChanged'</span>, arr);
    <span class="hljs-keyword">return</span> arr;
  }
});
<span class="hljs-comment">// prints itemChanged 0 2</span>
<span class="hljs-comment">// prints itemChanged 1 4</span>
<span class="hljs-comment">// prints itemChanged 2 6</span>
<span class="hljs-comment">// prints itemChanged 3 8</span>
<span class="hljs-comment">// prints arrayChanged [2,4,6,8]</span>
<span class="hljs-built_in">console</span>.log(instance.doubled);
<span class="hljs-comment">// prints [2,4,6,8]</span>
instance.setItem(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);
<span class="hljs-comment">// prints itemChanged 0 20</span>
<span class="hljs-comment">// prints arrayChanged [20,4,6,8]</span>
<span class="hljs-built_in">console</span>.log(instance.doubled);
<span class="hljs-comment">// prints [20,4,6,8]</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="batching"></a><a href="#batching" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Batching</h2>
<p>If you want to trigger multiple setters on your model at once you can use the batching APIs,</p>
<pre><code class="hljs css languages- js"><span class="hljs-keyword">const</span> modelFunction = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./model-reactions.carmi'</span>);
<span class="hljs-keyword">const</span> instance = modelFunction([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>], {
  <span class="hljs-attr">logItemChanged</span>: <span class="hljs-function">(<span class="hljs-params">value, idx</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'itemChanged'</span>, idx, value);
    <span class="hljs-keyword">return</span> value;
  },
  <span class="hljs-attr">logArrayChanged</span>: <span class="hljs-function"><span class="hljs-params">arr</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'arrayChanged'</span>, arr);
    <span class="hljs-keyword">return</span> arr;
  }
});
<span class="hljs-comment">// prints itemChanged 0 2</span>
<span class="hljs-comment">// prints itemChanged 1 4</span>
<span class="hljs-comment">// prints itemChanged 2 6</span>
<span class="hljs-comment">// prints itemChanged 3 8</span>
<span class="hljs-comment">// prints arrayChanged [2,4,6,8]</span>
instance.$startBatch();
instance.setItem(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);
instance.setItem(<span class="hljs-number">1</span>, <span class="hljs-number">20</span>);
instance.$endBatch();
<span class="hljs-comment">// prints itemChanged 0 20</span>
<span class="hljs-comment">// prints itemChanged 10 40</span>
<span class="hljs-comment">// prints arrayChanged [20,40,6,8]</span>
<span class="hljs-comment">// the print only happens once because the setters were batched</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview">Overview</a></li><li><a href="#derived-state">Derived state</a><ul class="toc-headings"><li><a href="#reactions">Reactions</a></li></ul></li><li><a href="#batching">Batching</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"></a><div><h5>Docs</h5><a href="/docs/en/getting-started.html">Getting Started</a><a href="/docs/en/api.html">API Reference</a></div><div><h5>More</h5><a href="https://github.com/wix-incubator/carmi">GitHub</a><a class="github-button" href="https://github.com/wix-incubator/carmi" data-icon="octicon-star" data-count-href="/wix-incubator/carmi/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2018 Wix</section></footer></div></body></html>